<!DOCTYPE html>
<html lang="zh">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover">
    <title>æ‰‹æ©ŸèŠå¤©æ‡‰ç”¨ - æ•´åˆåŠŸèƒ½ç‰ˆ</title>
    <link rel="stylesheet" href="theme-style.css">
    <link rel="stylesheet" href="chat-style.css">
    <link rel="stylesheet" href="chat_user_features_style.css">
    <script src="icon-config.js"></script>
    <script src="group-member-manager.js"></script>
    <script src="member-manager.js"></script>
    <script src="private-chat-manager.js"></script>
    
    <style>
    /* iOS å®‰å…¨åŒºåŸŸå’Œ 100dvh æ”¯æŒ */
    html, body { 
        height: 100%; 
        margin: 0;
        padding: 0;
    }
    
    /* å…ˆç”¨ 100dvhï¼ŒèˆŠæ©Ÿå‹ fallback ç”¨ JS è®Šæ•¸ */
    :root { 
        --app-vh: 100dvh; 
    }
    
    @supports not (height: 100dvh) {
        :root { 
            --app-vh: 100vh; 
        } /* å…ˆçµ¦å€‹å€¼ï¼Œç­‰ JS è¦†å¯« */
    }

    /* å…¨å±å®¹å™¨ä½¿ç”¨ --app-vh */
    .screen {
        min-height: var(--app-vh);
        height: var(--app-vh);
        /* iOS 12â€“15 çš„æ•‘å‘½ç¹ƒå¸¶ */
        height: -webkit-fill-available;
        overflow: hidden;
        padding-bottom: env(safe-area-inset-bottom);
        overscroll-behavior: contain;
    }
    
    /* ä¿®å¤æ¨¡æ€çª—å£é«˜åº¦ */
    #addStoryModal {
        height: var(--app-vh) !important;
    }
    
    .quick-actions-modal {
        height: var(--app-vh) !important;
    }
    </style>

<style>
/* æµ®åŠ¨åŠ©æ‰‹æ ·å¼ */
.floating-assistant {
    position: fixed;
    z-index: 99999;
    right: 20px;
    top: 50%;
    transform: translateY(-50%);
    user-select: none;
}

.floating-button {
    width: 56px;
    height: 56px;
    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    cursor: grab;
    box-shadow: 0 4px 20px rgba(0, 0, 0, 0.3);
    transition: all 0.3s ease;
    border: 3px solid rgba(255, 255, 255, 0.2);
}

.floating-button:hover {
    transform: scale(1.1);
    box-shadow: 0 6px 25px rgba(0, 0, 0, 0.4);
}

.floating-button:active {
    cursor: grabbing;
    transform: scale(0.95);
}

.floating-icon {
    font-size: 24px;
    color: white;
    pointer-events: none;
}

/* å¿«æ·æŒ‡ä»¤æ¨¡æ€çª—å£ */
.quick-actions-modal {
    position: fixed !important;
    top: 0 !important;
    left: 0 !important;
    width: 100% !important;
    height: 100% !important;
    background-color: rgba(0, 0, 0, 0.5) !important;
    z-index: 10000 !important;
    display: flex !important;
    align-items: center !important;
    justify-content: center !important;
}

.quick-actions-modal.hidden {
    display: none !important;
}

.quick-actions-content {
    background: white !important;
    border-radius: 16px !important;
    width: 90% !important;
    max-width: 400px !important;
    max-height: 80vh !important;
    overflow-y: auto !important;
    box-shadow: 0 20px 40px rgba(0, 0, 0, 0.3) !important;
}

.quick-actions-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: 20px;
    border-bottom: 1px solid #eee;
}

.quick-actions-header h3 {
    margin: 0;
    color: #333;
    font-size: 18px;
}

.quick-actions-body {
    padding: 20px;
}

.quick-action-section {
    margin-bottom: 24px;
}

.quick-action-section h4 {
    margin: 0 0 12px 0;
    color: #555;
    font-size: 14px;
    font-weight: 600;
}

.quick-action-btn {
    display: block;
    width: 100%;
    padding: 12px 16px;
    margin-bottom: 8px;
    border: none;
    border-radius: 8px;
    font-size: 14px;
    font-weight: 500;
    cursor: pointer;
    transition: all 0.2s ease;
    text-align: left;
}

.ai-btn {
    background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);
    color: white;
}

.ai-btn:hover {
    transform: translateY(-2px);
    box-shadow: 0 4px 12px rgba(79, 172, 254, 0.3);
}

.group-btn {
    background: linear-gradient(135deg, #a8edea 0%, #fed6e3 100%);
    color: #333;
}

.group-btn:hover {
    transform: translateY(-2px);
    box-shadow: 0 4px 12px rgba(168, 237, 234, 0.3);
}

.story-btn {
    background: linear-gradient(135deg, #9C27B0 0%, #7B1FA2 100%);
    color: white;
}

.story-btn:hover {
    transform: translateY(-2px);
    box-shadow: 0 4px 12px rgba(156, 39, 176, 0.3);
}

.quick-groups-grid {
    display: grid;
    gap: 8px;
}

.hidden {
    display: none !important;
}

#addStoryModal.hidden { display: none !important; }
#addStoryModal {
    position: fixed !important;
    top: 0; left: 0; width: 100vw; height: var(--app-vh);
    background: #0005;
    z-index: 99999 !important;
    display: flex; align-items: center; justify-content: center;
}
#storyListSection .story-row:hover { background:#f0f0ff; }
</style>
</head>

<body>

    <div id="chatListScreen" class="screen">
        <div class="chat-header">
            <span class="back-button" style="visibility: hidden;">â†</span>
            <h2 style="margin: 0; font-size: 20px;">èŠå¤©åˆ—è¡¨</h2>
            <div style="display: flex; align-items: center; gap: 8px;">
                <span style="cursor: pointer; font-size: 24px;" onclick="showAddGroupMenu()">+</span>
                <span style="cursor: pointer; font-size: 20px;" onclick="window.manualCleanupIdMappings()" title="æ¸…ç†éæœŸIDæ˜ å°„">ğŸ”</span>
            </div>
            <div id="addGroupMenu" class="options-menu hidden" style="top: 60px; right: 15px;">
                <ul>
                    <li onclick="openAddGroupModal()">æ·»åŠ ç¾¤çµ„</li>
                    <li onclick="openAddPrivateChatModal()">å‰µå»ºç§è¨Š</li>
                    <li onclick="openAddStoryChatModal()">å‰µå»ºåŠ‡æƒ…èŠå¤©å®¤</li>
                    <li onclick="openThemeSettingsModal()">ä¸»é¡Œæ¨£å¼è¨­ç½®</li>
                </ul>
            </div>
            <div class="stream-indicator" id="streamIndicator">ç›´æ’­ä¸­</div>
        </div>
        <div class="chat-list-body">
            <div id="unifiedChatList" class="unified-chat-list"></div>
        </div>
    </div>

    <div id="chatDetailScreen" class="screen hidden">
        <!-- ç§èŠå°ˆç”¨ headerï¼Œé è¨­éš±è—ï¼Œåƒ…ç§èŠé¡¯ç¤º -->
        <div id="privateChatHeader" class="private-chat-header" style="display:none;">
            <span class="back-button" onclick="showChatList()">â†</span>
            <div class="private-header-avatar">
                <img id="privateHeaderAvatarImg" src="https://files.catbox.moe/ew2nex.png" alt="è§’è‰²é ­åƒ" />
            </div>
            <div class="private-header-info">
                <div class="private-header-name" id="privateHeaderName">è§’è‰²åç¨±</div>
                <div class="private-header-status"><span class="private-header-dot"></span> åœ¨ç·š</div>
            </div>
            <span class="private-header-heart" id="privateChatOptionsButton" onclick="toggleChatOptionsMenu()">&#9829;</span>
        </div>
        <!-- åŸæœ‰ headerï¼Œéç§èŠé¡¯ç¤º -->
        <div class="chat-header" id="defaultChatHeader">
            <span class="back-button" onclick="showChatList()">â†</span>
            <h2 id="chatTitle" style="margin: 0; font-size: 20px; overflow: hidden; text-overflow: ellipsis; white-space: nowrap;">èŠå¤©å®¤</h2>
            <span id="chatOptionsButton" style="cursor: pointer; font-size: 24px;" onclick="toggleChatOptionsMenu()">â‹®</span>
            <div class="stream-indicator" id="detailStreamIndicator">ç›´æ’­ä¸­</div>
        </div>
        <div class="chat-body">
        </div>
        <div class="ai-chat-footer">
            <button id="addButton" class="add-button">+</button>
            <input type="text" id="userInput" placeholder="ä»¥ã€Œ{{user}}ã€çš„èº«ä»½ç™¼è¨€...">
            <button id="choiceDropdownButton" class="choice-dropdown-button" style="margin-left: 6px; margin-right: 6px;">ğŸ’¡</button>
            <button id="sendButton">ç™¼é€</button>
        </div>
        <div id="choiceDropdownMenu" class="choice-dropdown-menu hidden"></div>

        <div id="bottomFunctionPanel" class="bottom-function-panel hidden">
            <div class="function-panel-content">
    <div class="function-grid-container">
        <div class="function-grid">
    <!-- ğŸ–¼ï¸ ç…§ç‰‡åŠŸèƒ½ - è«‹æ›¿æ› ICON_URL_PHOTO ç‚ºä½ çš„åœ–ç‰‡URL -->
    <div class="function-item" onclick="selectFunction('photo')">
        <div class="function-icon">
            <img src="ICON_URL_PHOTO" alt="ç…§ç‰‡" class="function-icon-img">
            <span class="function-icon-fallback">ğŸ“·</span>
        </div>
        <div class="function-label">ç…§ç‰‡</div>
    </div>
    
    <!-- â° æ™‚é–“åŠŸèƒ½ - è«‹æ›¿æ› ICON_URL_TIME ç‚ºä½ çš„åœ–ç‰‡URL -->
    <div class="function-item" onclick="selectFunction('time_adjustment')">
        <div class="function-icon">
            <img src="ICON_URL_TIME" alt="æ™‚é–“" class="function-icon-img">
            <span class="function-icon-fallback">â°</span>
        </div>
        <div class="function-label">æ—¶é—´</div>
    </div>
    
    <!-- ğŸ“¹ è¦–è¨Šé€šè©±åŠŸèƒ½ - è«‹æ›¿æ› ICON_URL_VIDEO_CALL ç‚ºä½ çš„åœ–ç‰‡URL -->
    <div class="function-item" onclick="selectFunction('video_call')">
        <div class="function-icon">
            <img src="ICON_URL_VIDEO_CALL" alt="è¦–è¨Šé€šè©±" class="function-icon-img">
            <span class="function-icon-fallback">ğŸ“¹</span>
        </div>
        <div class="function-label">è¦–è¨Šé€šè©±</div>
    </div>
    
    <!-- ğŸ“ ä½ç½®åŠŸèƒ½ - è«‹æ›¿æ› ICON_URL_LOCATION ç‚ºä½ çš„åœ–ç‰‡URL -->
    <div class="function-item" onclick="selectFunction('location')">
        <div class="function-icon">
            <img src="ICON_URL_LOCATION" alt="ä½ç½®" class="function-icon-img">
            <span class="function-icon-fallback">ğŸ“</span>
        </div>
        <div class="function-label">ä½ç½®</div>
    </div>
    
    <!-- ğŸ§§ ç´…åŒ…åŠŸèƒ½ - è«‹æ›¿æ› ICON_URL_RED_ENVELOPE ç‚ºä½ çš„åœ–ç‰‡URL -->
    <div class="function-item" onclick="selectFunction('red_envelope')">
        <div class="function-icon">
            <img src="ICON_URL_RED_ENVELOPE" alt="ç´…åŒ…" class="function-icon-img">
            <span class="function-icon-fallback">ğŸ§§</span>
        </div>
        <div class="function-label">ç´…åŒ…</div>
    </div>
    
    <!-- ğŸ’° è½‰è³¬åŠŸèƒ½ - è«‹æ›¿æ› ICON_URL_TRANSFER ç‚ºä½ çš„åœ–ç‰‡URL -->
    <div class="function-item" onclick="selectFunction('transfer')">
        <div class="function-icon">
            <img src="ICON_URL_TRANSFER" alt="è½‰è³¬" class="function-icon-img">
            <span class="function-icon-fallback">ğŸ’°</span>
        </div>
        <div class="function-label">è½‰è³¬</div>
    </div>
    
    <!-- ğŸ¤ èªéŸ³è¼¸å…¥åŠŸèƒ½ - è«‹æ›¿æ› ICON_URL_VOICE_INPUT ç‚ºä½ çš„åœ–ç‰‡URL -->
    <div class="function-item" onclick="selectFunction('voice_input')">
        <div class="function-icon">
            <img src="ICON_URL_VOICE_INPUT" alt="èªéŸ³è¼¸å…¥" class="function-icon-img">
            <span class="function-icon-fallback">ğŸ¤</span>
        </div>
        <div class="function-label">èªéŸ³è¼¸å…¥</div>
    </div>
    
    <!-- ğŸ˜Š è¡¨æƒ…åŒ…åŠŸèƒ½ - è«‹æ›¿æ› ICON_URL_STICKER ç‚ºä½ çš„åœ–ç‰‡URL -->
    <div class="function-item" onclick="selectFunction('sticker')">
        <div class="function-icon">
            <img src="ICON_URL_STICKER" alt="è¡¨æƒ…åŒ…" class="function-icon-img">
            <span class="function-icon-fallback">ğŸ˜Š</span>
        </div>
        <div class="function-label">è¡¨æƒ…åŒ…</div>
    </div>
    
    <!-- ğŸ“– åŠ‡æƒ…åŠŸèƒ½ - è«‹æ›¿æ› ICON_URL_USER_STORY ç‚ºä½ çš„åœ–ç‰‡URL -->
    <div class="function-item" onclick="selectFunctionWithModal('user_story')">
        <div class="function-icon">
            <img src="ICON_URL_USER_STORY" alt="åŠ‡æƒ…" class="function-icon-img">
            <span class="function-icon-fallback">ğŸ“–</span>
        </div>
        <div class="function-label">åŠ‡æƒ…</div>
    </div>
    
    <!-- âš™ï¸ ç³»çµ±åŠŸèƒ½ - è«‹æ›¿æ› ICON_URL_SYSTEM_ACTION ç‚ºä½ çš„åœ–ç‰‡URL -->
    <div class="function-item" onclick="selectFunctionWithModal('system_action')">
        <div class="function-icon">
            <img src="ICON_URL_SYSTEM_ACTION" alt="ç³»çµ±" class="function-icon-img">
            <span class="function-icon-fallback">âš™ï¸</span>
        </div>
        <div class="function-label">ç³»çµ±</div>
    </div>
    
    <!-- âœ‰ï¸ ä¿¡å°åŠŸèƒ½ - è«‹æ›¿æ› ICON_URL_LETTER ç‚ºä½ çš„åœ–ç‰‡URL -->
    <div class="function-item" onclick="selectFunctionWithModal('letter')">
        <div class="function-icon">
            <img src="ICON_URL_LETTER" alt="ä¿¡å°" class="function-icon-img">
            <span class="function-icon-fallback">âœ‰ï¸</span>
        </div>
        <div class="function-label">ä¿¡å°</div>
    </div>
    

    
    <!-- ğŸ é€ç¦®åŠŸèƒ½ - è«‹æ›¿æ› ICON_URL_GIFT ç‚ºä½ çš„åœ–ç‰‡URL -->
    <div class="function-item" onclick="selectFunctionWithModal('gift')">
        <div class="function-icon">
            <img src="ICON_URL_GIFT" alt="é€ç¦®" class="function-icon-img">
            <span class="function-icon-fallback">ğŸ</span>
        </div>
        <div class="function-label">é€ç¦®</div>
    </div>
        </div>
    </div>
    <div class="pagination-dots"></div>
            </div>
        </div>
</div>
    
    <div class="debug-panel" style="display: none !important;"></div>

    <div id="chatOptionsMenu" class="options-menu hidden">
    <ul>
        <li onclick="openBackgroundModal()">è¨­ç½®èƒŒæ™¯</li>
        <li id="groupSettingsOption" onclick="openGroupSettingsModal()" style="display: none;">ç¾¤èŠè¨­ç½®</li>
        <li id="privateChatSettingsOption" onclick="openPrivateChatSettingsModal()" style="display: none;">ç§èŠè¨­ç½®</li>
    </ul>
</div>

    <div id="backgroundSettingsModal" class="modal-overlay hidden">
        <div class="modal-content">
            <div class="modal-header">
                <h3>èƒŒæ™¯è¨­ç½®</h3>
                <span class="close-button" onclick="closeBackgroundModal()">&times;</span>
            </div>
            <div class="modal-body">
                <label for="backgroundUrlInput" style="color: var(--modal-text-color); margin-bottom: 8px; display: block;">åœ–ç‰‡ URL:</label>
                <input type="text" id="backgroundUrlInput" placeholder="è«‹è²¼ä¸Šåœ–ç‰‡é€£çµ..." style="width: 100%; padding: 8px 12px; border: 2px solid #999; border-radius: 8px; box-sizing: border-box; font-size: 14px; background: white; color: #333;">
                
                <div style="margin-top: 20px; text-align: center;">
                    <div style="color: var(--modal-text-color); margin-bottom: 8px;">æˆ–</div>
                </div>
                
                <label for="backgroundImageUpload" style="color: var(--modal-text-color); margin-bottom: 8px; display: block;">ä¸Šå‚³åœ–ç‰‡:</label>
                <div class="background-upload-section">
                    <input type="file" id="backgroundImageUpload" accept="image/*" style="display: none;">
                    <button type="button" class="background-upload-btn" onclick="document.getElementById('backgroundImageUpload').click()">
                        <img id="backgroundImagePreview" src="https://files.catbox.moe/ew2nex.png" alt="èƒŒæ™¯é è¦½" class="background-image-preview">
                        <span class="background-upload-text">é¸æ“‡åœ–ç‰‡</span>
                    </button>
                </div>
                
                <div id="uploadedImagesList" style="margin-top: 15px; display: none;">
                    <label style="color: var(--modal-text-color); margin-bottom: 8px; display: block;">å·²ä¸Šå‚³çš„åœ–ç‰‡:</label>
                    <div id="uploadedImagesContainer" class="uploaded-images-container">
                        <!-- å·²ä¸Šå‚³çš„åœ–ç‰‡å°‡åœ¨é€™è£¡é¡¯ç¤º -->
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button id="confirmBackgroundChange" onclick="applyBackgroundChange()" class="function-btn-confirm">ç¢ºå®š</button>
            </div>
        </div>
    </div>

    <div id="addGroupModal" class="modal-overlay hidden">
        <div class="modal-content" style="max-height: 80vh; overflow-y: auto;">
            <div class="modal-header">
                <h3>æ·»åŠ ç¾¤çµ„</h3>
            </div>
            <div class="modal-body" style="max-height: 60vh; overflow-y: auto;">
                <label for="groupNameInput" style="color: var(--modal-text-color);">ç¾¤çµ„åç¨±:</label>
                <input type="text" id="groupNameInput" placeholder="è«‹è¼¸å…¥ç¾¤çµ„åç¨±..." maxlength="20">
                
                <label for="groupAvatarInput" style="margin-top: 15px; display: block; color: var(--modal-text-color);">ç¾¤çµ„é ­åƒ:</label>
                <div class="group-avatar-section">
                    <div class="group-avatar-upload">
                        <input type="file" id="groupAvatarInput" accept="image/*" style="display: none;">
                        <button type="button" class="group-avatar-btn" onclick="document.getElementById('groupAvatarInput').click()">
                            <img id="groupAvatarPreview" src="https://files.catbox.moe/ew2nex.png" alt="ç¾¤çµ„é ­åƒ" class="group-avatar-preview">
                            <span class="group-avatar-text">ä¸Šå‚³ç¾¤çµ„é ­åƒ</span>
                        </button>
                    </div>
                </div>
                
                <label for="adminNameInput" style="color: var(--modal-text-color);">ç¾¤çµ„å‰µå»ºè€… (ä½ ):</label>
                <div class="admin-input-container">
                    <input type="text" id="adminNameInput" placeholder="è«‹è¼¸å…¥ä½ çš„åç¨±..." maxlength="15">
                    <div class="admin-avatar-section">
                        <label for="adminAvatarInput" class="admin-avatar-label" style="color: var(--modal-text-color);">é ­åƒ:</label>
                        <div class="admin-avatar-upload">
                            <input type="file" id="adminAvatarInput" accept="image/*" style="display: none;">
                            <button type="button" class="admin-avatar-btn" onclick="document.getElementById('adminAvatarInput').click()">
                                <img id="adminAvatarPreview" src="https://files.catbox.moe/ew2nex.png" alt="ä½ çš„é ­åƒ" class="admin-avatar-preview">
                                <span class="admin-avatar-text">æ›´æ›é ­åƒ</span>
                            </button>
                        </div>
                    </div>
                </div>
                
                <label for="membersInput" style="margin-top: 15px; display: block; color: var(--modal-text-color);">ç¾¤çµ„æˆå“¡ (å…¶ä»–äºº):</label>
                <div class="member-avatar-grid">
                    <div id="memberAvatarList" class="member-avatar-list">
                        <!-- æˆå“¡é ­åƒå°‡åœ¨é€™è£¡å‹•æ…‹é¡¯ç¤º -->
                    </div>
                    <button type="button" class="add-member-avatar-btn" onclick="openMemberManager()">
                        <span class="add-icon">+</span>
                        <span class="add-text">æ·»åŠ æˆå“¡</span>
                    </button>
                </div>

                <div style="margin-top: 15px;">
                <label for="groupDateInput" style="color: var(--modal-text-color);">åˆå§‹æ—¥æœŸ:</label>
                <input type="date" id="groupDateInput" style="width: 100%; padding: 8px; box-sizing: border-box;">

                <label for="groupTimeInput" style="margin-top: 10px; display: block; color: var(--modal-text-color);">åˆå§‹æ™‚é–“:</label>
                <input type="time" id="groupTimeInput" style="width: 100%; padding: 8px; box-sizing: border-box;">
                </div>
                
                <div style="margin-top: 15px;">
                    <label style="display: flex; align-items: center; cursor: pointer;">
                        <input type="checkbox" id="saveAsPresetCheckbox" style="margin-right: 8px;">
                        <span style="font-size: 14px; color: var(--modal-text-color);">ä¿å­˜ç‚ºé è¨­èŠå¤©å®¤ï¼ˆä¸‹æ¬¡æ‰“é–‹é¢æ¿æ™‚è‡ªå‹•é¡¯ç¤ºï¼‰</span>
                    </label>
                </div>
                
                <div style="margin-top: 10px; font-size: 12px; color: var(--modal-secondary-text-color);">
                    æç¤ºï¼šç¾¤çµ„å‰µå»ºè€…ï¼ˆä½ ï¼‰æœƒè‡ªå‹•åŠ å…¥ç¾¤çµ„ï¼Œæˆå“¡åˆ—è¡¨ä¸­çš„æ˜¯å…¶ä»–åƒèˆ‡è€…ã€‚å‰µå»ºå¾ŒAIæœƒè‡ªå‹•ç‚ºé€™å€‹ç¾¤çµ„ç”ŸæˆèŠå¤©å…§å®¹ã€‚
                </div>
            </div>
            <div class="modal-footer">
                <button onclick="closeAddGroupModal()" class="function-btn-cancel">å–æ¶ˆ</button>
                <button id="confirmAddGroup" onclick="createNewGroup()" class="function-btn-confirm">å‰µå»ºç¾¤çµ„</button>
            </div>
        </div>
    </div>

    <!-- ğŸ†• ç°¡åŒ–çš„æˆå“¡æ·»åŠ çª—å£ -->
    <div id="memberManagerModal" class="modal-overlay hidden">
        <div class="modal-content member-add-content" style="max-height: 80vh; overflow-y: auto;">
            <div class="modal-header">
                <h3>ğŸ‘¤ æ·»åŠ ç¾¤çµ„æˆå“¡</h3>
            </div>
            <div class="modal-body" style="max-height: 60vh; overflow-y: auto;">
                <div class="member-form">
                    <div class="form-row">
                        <label for="memberNameInput" style="color: var(--modal-text-color);">æˆå“¡åç¨±:</label>
                        <input type="text" id="memberNameInput" placeholder="è«‹è¼¸å…¥æˆå“¡åç¨±..." maxlength="20">
                    </div>
                    <div class="form-row">
                        <label for="memberDisplayNameInput" style="color: var(--modal-text-color);">é¡¯ç¤ºåç¨± (å¯é¸):</label>
                        <input type="text" id="memberDisplayNameInput" placeholder="ç•™ç©ºå‰‡ä½¿ç”¨æˆå“¡åç¨±" maxlength="20">
                    </div>
                    <div class="form-row">
                        <label for="memberAvatarInput" style="color: var(--modal-text-color);">é ­åƒ:</label>
                        <div class="avatar-upload-container">
                            <input type="file" id="memberAvatarInput" accept="image/*" style="display: none;">
                            <button type="button" class="avatar-upload-btn" onclick="document.getElementById('memberAvatarInput').click()">
                                <span id="avatarPreviewText">é¸æ“‡åœ–ç‰‡</span>
                                <img id="avatarPreview" src="" alt="" style="display: none; width: 40px; height: 40px; border-radius: 50%; object-fit: cover;">
                            </button>
                        </div>
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button onclick="addMemberAndClose()" class="function-btn-confirm">æ·»åŠ æˆå“¡</button>
                <button onclick="closeMemberManager()" class="function-btn-cancel">å–æ¶ˆ</button>
            </div>
        </div>
    </div>

    <div id="addPrivateChatModal" class="modal-overlay hidden">
        <div class="modal-content" style="max-height: 80vh; overflow-y: auto;">
            <div class="modal-header">
                <h3>å‰µå»ºç§è¨Š</h3>
            </div>
            <div class="modal-body" style="max-height: 60vh; overflow-y: auto;">
                <label for="yourNameInput" style="color: var(--modal-text-color);">ä½ çš„åç¨±:</label>
                <div class="user-input-container">
                    <input type="text" id="yourNameInput" placeholder="è«‹è¼¸å…¥ä½ çš„åç¨±..." maxlength="15">
                    <div class="user-avatar-section">
                        <label for="userAvatarInput" class="user-avatar-label" style="color: var(--modal-text-color);">ä½ çš„é ­åƒ:</label>
                        <div class="user-avatar-upload">
                            <input type="file" id="userAvatarInput" accept="image/*" style="display: none;">
                            <button type="button" class="user-avatar-btn" onclick="document.getElementById('userAvatarInput').click()">
                                <img id="userAvatarPreview" src="https://files.catbox.moe/ew2nex.png" alt="ä½ çš„é ­åƒ" class="user-avatar-preview">
                                <span class="user-avatar-text">æ›´æ›é ­åƒ</span>
                            </button>
                        </div>
                    </div>
                </div>
                
                <label for="otherPersonNameInput" style="margin-top: 15px; display: block; color: var(--modal-text-color);">å°æ–¹åç¨±:</label>
                <div class="character-input-container">
                    <input type="text" id="otherPersonNameInput" placeholder="è«‹è¼¸å…¥å°æ–¹çš„è§’è‰²åç¨±..." maxlength="15">
                    <div class="character-avatar-section">
                        <label for="characterAvatarInput" class="character-avatar-label" style="color: var(--modal-text-color);">è§’è‰²é ­åƒ:</label>
                        <div class="character-avatar-upload">
                            <input type="file" id="characterAvatarInput" accept="image/*" style="display: none;">
                            <button type="button" class="character-avatar-btn" onclick="document.getElementById('characterAvatarInput').click()">
                                <img id="characterAvatarPreview" src="https://files.catbox.moe/ew2nex.png" alt="è§’è‰²é ­åƒ" class="character-avatar-preview">
                                <span class="character-avatar-text">æ›´æ›é ­åƒ</span>
                            </button>
                        </div>
                    </div>
                </div>

                <div style="margin-top: 15px;">
                    <label for="privateChatDateInput" style="color: var(--modal-text-color);">åˆå§‹æ—¥æœŸ:</label>
                    <input type="date" id="privateChatDateInput" style="width: 100%; padding: 8px; box-sizing: border-box;">

                    <label for="privateChatTimeInput" style="margin-top: 10px; display: block; color: var(--modal-text-color);">åˆå§‹æ™‚é–“:</label>
                    <input type="time" id="privateChatTimeInput" style="width: 100%; padding: 8px; box-sizing: border-box;">
                </div>
                
                <div style="margin-top: 15px;">
                    <label style="display: flex; align-items: center; cursor: pointer;">
                        <input type="checkbox" id="savePrivateAsPresetCheckbox" style="margin-right: 8px;">
                        <span style="font-size: 14px; color: var(--modal-text-color);">ä¿å­˜ç‚ºé è¨­èŠå¤©å®¤ï¼ˆä¸‹æ¬¡æ‰“é–‹é¢æ¿æ™‚è‡ªå‹•é¡¯ç¤ºï¼‰</span>
                    </label>
                </div>
                
                <div style="margin-top: 10px; font-size: 12px; color: var(--modal-secondary-text-color);">
                    æç¤ºï¼šå‰µå»ºå¾ŒAIæœƒè‡ªå‹•ç‚ºé€™å€‹ç§è¨Šç”Ÿæˆå°è©±å…§å®¹
                </div>
            </div>
            <div class="modal-footer">
                <button onclick="closeAddPrivateChatModal()" class="function-btn-cancel">å–æ¶ˆ</button>
                <button id="confirmAddPrivateChat" onclick="createNewPrivateChat()" class="function-btn-confirm">å‰µå»ºç§è¨Š</button>
            </div>
        </div>
    </div>

    <div id="addStoryChatModal" class="modal-overlay hidden">
        <div class="modal-content" style="max-height: 80vh; overflow-y: auto;">
            <div class="modal-header">
                <h3>å‰µå»ºåŠ‡æƒ…èŠå¤©å®¤</h3>
            </div>
            <div class="modal-body" style="max-height: 60vh; overflow-y: auto;">
                <label for="storyNameInput" style="color: var(--modal-text-color);">åŠ‡æƒ…æ¨™é¡Œ:</label>
                <input type="text" id="storyNameInput" placeholder="è«‹è¼¸å…¥åŠ‡æƒ…æ¨™é¡Œ..." maxlength="30">
                
                <label for="storyDescriptionInput" style="color: var(--modal-text-color);">åŠ‡æƒ…æè¿°:</label>
                <textarea id="storyDescriptionInput" placeholder="è«‹ç°¡è¿°åŠ‡æƒ…èƒŒæ™¯æˆ–è¨­å®š..." maxlength="200" style="width: 100%; padding: 8px; box-sizing: border-box; height: 80px; resize: vertical;"></textarea>

                <div style="margin-top: 15px;">
                    <label for="storyChatDateInput" style="color: var(--modal-text-color);">åŠ‡æƒ…é–‹å§‹æ—¥æœŸ:</label>
                    <input type="date" id="storyChatDateInput" style="width: 100%; padding: 8px; box-sizing: border-box;">

                    <label for="storyChatTimeInput" style="margin-top: 10px; display: block; color: var(--modal-text-color);">åŠ‡æƒ…é–‹å§‹æ™‚é–“:</label>
                    <input type="time" id="storyChatTimeInput" style="width: 100%; padding: 8px; box-sizing: border-box;">
                </div>
                
                <div style="margin-top: 15px;">
                    <label style="display: flex; align-items: center; cursor: pointer;">
                        <input type="checkbox" id="saveStoryAsPresetCheckbox" style="margin-right: 8px;">
                        <span style="font-size: 14px; color: var(--modal-text-color);">ä¿å­˜ç‚ºé è¨­èŠå¤©å®¤ï¼ˆä¸‹æ¬¡æ‰“é–‹é¢æ¿æ™‚è‡ªå‹•é¡¯ç¤ºï¼‰</span>
                    </label>
                </div>
                
                <div style="margin-top: 10px; font-size: 12px; color: var(--modal-secondary-text-color);">
                    ğŸ’¡ æç¤ºï¼šåŠ‡æƒ…èŠå¤©å®¤å°ˆé–€ç”¨ä¾†å±•ç¤ºåŠ‡æƒ…ç™¼å±•ã€å ´æ™¯æè¿°å’Œç³»çµ±æ¶ˆæ¯ï¼ŒAIæœƒè‡ªå‹•å°‡åŠ‡æƒ…å…§å®¹ç™¼é€åˆ°é€™è£¡
                </div>
            </div>
            <div class="modal-footer">
                <button onclick="closeAddStoryChatModal()" class="function-btn-cancel">å–æ¶ˆ</button>
                <button id="confirmAddStoryChat" onclick="createNewStoryChat()" class="function-btn-confirm">å‰µå»ºåŠ‡æƒ…èŠå¤©å®¤</button>
            </div>
        </div>
    </div>


    <div id="groupSettingsModal" class="modal-overlay hidden">
        <div class="modal-content" style="max-height: 80vh; overflow-y: auto;">
            <div class="modal-header">
                <h3>ç¾¤èŠè¨­ç½®</h3>
            </div>
            <div class="modal-body" style="max-height: 60vh; overflow-y: auto;">
                <label for="groupSettingsNameInput">ç¾¤çµ„åç¨±:</label>
                <input type="text" id="groupSettingsNameInput" placeholder="è«‹è¼¸å…¥ç¾¤çµ„åç¨±..." maxlength="20">
                
                <label for="groupSettingsGroupAvatarInput" style="margin-top: 15px; display: block;">ç¾¤çµ„é ­åƒ:</label>
                <div class="group-avatar-section">
                    <div class="group-avatar-upload">
                        <input type="file" id="groupSettingsGroupAvatarInput" accept="image/*" style="display: none;">
                        <button type="button" class="group-avatar-btn" onclick="document.getElementById('groupSettingsGroupAvatarInput').click()">
                            <img id="groupSettingsGroupAvatarPreview" src="https://files.catbox.moe/ew2nex.png" alt="ç¾¤çµ„é ­åƒ" class="group-avatar-preview">
                            <span class="group-avatar-text">æ›´æ›ç¾¤çµ„é ­åƒ</span>
                        </button>
                    </div>
                </div>
                
                <label for="groupSettingsAdminInput">ç¾¤çµ„å‰µå»ºè€… (ä½ ):</label>
                <div class="admin-input-container">
                    <input type="text" id="groupSettingsAdminInput" placeholder="è«‹è¼¸å…¥ä½ çš„åç¨±..." maxlength="15">
                    <div class="admin-avatar-section">
                        <label for="groupSettingsAdminAvatarInput" class="admin-avatar-label">é ­åƒ:</label>
                        <div class="admin-avatar-upload">
                            <input type="file" id="groupSettingsAdminAvatarInput" accept="image/*" style="display: none;">
                            <button type="button" class="admin-avatar-btn" onclick="document.getElementById('groupSettingsAdminAvatarInput').click()">
                                <img id="groupSettingsAdminAvatarPreview" src="https://files.catbox.moe/ew2nex.png" alt="ä½ çš„é ­åƒ" class="admin-avatar-preview">
                                <span class="admin-avatar-text">æ›´æ›é ­åƒ</span>
                            </button>
                        </div>
                    </div>
                </div>
                
                <label for="groupSettingsMembersInput" style="margin-top: 15px; display: block;">ç¾¤çµ„æˆå“¡ (å…¶ä»–äºº):</label>
                <div class="member-avatar-grid">
                    <div id="groupSettingsMemberAvatarList" class="member-avatar-list">
                        <!-- æˆå“¡é ­åƒå°‡åœ¨é€™è£¡å‹•æ…‹é¡¯ç¤º -->
                    </div>
                    <button type="button" class="add-member-avatar-btn" onclick="openGroupSettingsMemberManager()">
                        <span class="add-icon">+</span>
                        <span class="add-text">æ·»åŠ æˆå“¡</span>
                    </button>
                </div>

                <div style="margin-top: 15px;">
                <label for="groupSettingsDateInput">åˆå§‹æ—¥æœŸ:</label>
                <input type="date" id="groupSettingsDateInput" style="width: 100%; padding: 8px; box-sizing: border-box;">

                <label for="groupSettingsTimeInput" style="margin-top: 10px; display: block;">åˆå§‹æ™‚é–“:</label>
                <input type="time" id="groupSettingsTimeInput" style="width: 100%; padding: 8px; box-sizing: border-box;">
                </div>
                
                <div style="margin-top: 10px; font-size: 12px; color: #666;">
                    æç¤ºï¼šä¿®æ”¹è¨­ç½®å¾Œæœƒç«‹å³ç”Ÿæ•ˆï¼Œä½†ä¸æœƒå½±éŸ¿å·²ç™¼é€çš„æ¶ˆæ¯ã€‚
                </div>
            </div>
            <div class="modal-footer">
                <button onclick="closeGroupSettingsModal()" class="function-btn-cancel">å–æ¶ˆ</button>
                <button id="confirmGroupSettings" onclick="applyGroupSettings()" class="function-btn-confirm">ä¿å­˜è¨­ç½®</button>
            </div>
        </div>
    </div>

    <!-- ğŸ†• ç§èŠè¨­ç½®æ¨¡æ…‹çª—å£ -->
    <div id="privateChatSettingsModal" class="modal-overlay hidden">
        <div class="modal-content" style="max-height: 80vh; overflow-y: auto;">
            <div class="modal-header">
                <h3>ç§èŠè¨­ç½®</h3>
            </div>
            <div class="modal-body" style="max-height: 60vh; overflow-y: auto;">
                <label for="privateChatSettingsNameInput">èŠå¤©åç¨±:</label>
                <input type="text" id="privateChatSettingsNameInput" placeholder="è«‹è¼¸å…¥èŠå¤©åç¨±..." maxlength="20">
                
                <label for="privateChatSettingsUserInput">ä½ çš„åç¨±:</label>
                <div class="user-input-container">
                    <input type="text" id="privateChatSettingsUserInput" placeholder="è«‹è¼¸å…¥ä½ çš„åç¨±..." maxlength="15">
                    <div class="user-avatar-section">
                        <label for="privateChatSettingsUserAvatarInput" class="user-avatar-label">ä½ çš„é ­åƒ:</label>
                        <div class="user-avatar-upload">
                            <input type="file" id="privateChatSettingsUserAvatarInput" accept="image/*" style="display: none;">
                            <button type="button" class="user-avatar-btn" onclick="document.getElementById('privateChatSettingsUserAvatarInput').click()">
                                <img id="privateChatSettingsUserAvatarPreview" src="https://files.catbox.moe/ew2nex.png" alt="ä½ çš„é ­åƒ" class="user-avatar-preview">
                                <span class="user-avatar-text">æ›´æ›é ­åƒ</span>
                            </button>
                        </div>
                    </div>
                </div>
                
                <label for="privateChatSettingsCharacterInput" style="margin-top: 15px; display: block;">å°æ–¹åç¨±:</label>
                <div class="character-input-container">
                    <input type="text" id="privateChatSettingsCharacterInput" placeholder="è«‹è¼¸å…¥å°æ–¹çš„è§’è‰²åç¨±..." maxlength="15">
                    <div class="character-avatar-section">
                        <label for="privateChatSettingsCharacterAvatarInput" class="character-avatar-label">è§’è‰²é ­åƒ:</label>
                        <div class="character-avatar-upload">
                            <input type="file" id="privateChatSettingsCharacterAvatarInput" accept="image/*" style="display: none;">
                            <button type="button" class="character-avatar-btn" onclick="document.getElementById('privateChatSettingsCharacterAvatarInput').click()">
                                <img id="privateChatSettingsCharacterAvatarPreview" src="https://files.catbox.moe/ew2nex.png" alt="è§’è‰²é ­åƒ" class="character-avatar-preview">
                                <span class="character-avatar-text">æ›´æ›é ­åƒ</span>
                            </button>
                        </div>
                    </div>
                </div>

                <div style="margin-top: 15px;">
                <label for="privateChatSettingsDateInput">åˆå§‹æ—¥æœŸ:</label>
                <input type="date" id="privateChatSettingsDateInput" style="width: 100%; padding: 8px; box-sizing: border-box;">

                <label for="privateChatSettingsTimeInput" style="margin-top: 10px; display: block;">åˆå§‹æ™‚é–“:</label>
                <input type="time" id="privateChatSettingsTimeInput" style="width: 100%; padding: 8px; box-sizing: border-box;">
                </div>
                
                <div style="margin-top: 10px; font-size: 12px; color: #666;">
                    æç¤ºï¼šä¿®æ”¹è¨­ç½®å¾Œæœƒç«‹å³ç”Ÿæ•ˆï¼Œä½†ä¸æœƒå½±éŸ¿å·²ç™¼é€çš„æ¶ˆæ¯ã€‚
                </div>
            </div>
            <div class="modal-footer">
                <button onclick="closePrivateChatSettingsModal()" class="function-btn-cancel">å–æ¶ˆ</button>
                <button id="confirmPrivateChatSettings" onclick="applyPrivateChatSettings()" class="function-btn-confirm">ä¿å­˜è¨­ç½®</button>
            </div>
        </div>
    </div>

<div id="systemActionModal" class="function-modal hidden">
    <div class="function-modal-content">
        <div class="function-modal-header">
            <h3>âš™ï¸ ç³»çµ±æŒ‡ä»¤</h3>
            <span class="function-modal-close" onclick="closeFunctionModal('systemActionModal')">&times;</span>
        </div>
        <div class="function-modal-body">
            <label for="systemActionSelect">é¸æ“‡å‹•ä½œ:</label>
            <select id="systemActionSelect" style="width: 100%; padding: 8px; margin-bottom: 15px;">
                <option value="add">æ·»åŠ æˆå“¡</option>
                <option value="kick">ç§»é™¤æˆå“¡</option>
                <option value="mute">æˆå“¡ç¦è¨€ (å°é»‘å±‹)</option>
                <option value="block">æ‹‰é»‘æˆå“¡</option>
                <option value="broadcast">ç™¼é€å»£æ’­</option>
                <option value="leave">é›¢é–‹ç¾¤çµ„</option>
                <option value="disband">è§£æ•£ç¾¤çµ„</option>
            </select>

            <label for="systemActionOperator">æ“ä½œè€…:</label>
            <input type="text" id="systemActionOperator" placeholder="åŸ·è¡Œæ­¤æ“ä½œçš„è§’è‰²åç¨±">

            <label for="systemActionTarget">ç›®æ¨™è§’è‰²:</label>
            <input type="text" id="systemActionTarget" placeholder="ä¾‹å¦‚ï¼šé™³æ€èŠ³ (å»£æ’­æ™‚å¯ç•™ç©º)">

            <label for="systemActionValue">é™„åŠ åƒæ•¸:</label>
            <input type="text" id="systemActionValue" placeholder="ä¾‹å¦‚ï¼š1h æˆ– å»£æ’­å…§å®¹">
        </div>
        <div class="function-modal-footer">
            <button onclick="closeFunctionModal('systemActionModal')" class="function-btn-cancel">å–æ¶ˆ</button>
            <button onclick="confirmSystemAction()" class="function-btn-confirm">åŸ·è¡ŒæŒ‡ä»¤</button>
        </div>
    </div>
</div>


<!-- ğŸ é€ç¦®æ¨¡æ…‹çª—å£ -->
<div id="giftModal" class="function-modal hidden">
    <div class="function-modal-content">
        <div class="function-modal-header">
            <h3>ğŸ é€ç¦®ç‰©</h3>
            <span class="function-modal-close" onclick="closeFunctionModal('giftModal')">&times;</span>
        </div>
        <div class="function-modal-body">
            <label for="giftRecipient">é€çµ¦:</label>
            <select id="giftRecipient" style="width: 100%; padding: 8px; margin-bottom: 15px;">
                <option value="">é¸æ“‡æ¥æ”¶è€…...</option>
                <!-- å‹•æ…‹å¡«å……é¸é … -->
            </select>

            <label for="giftName">ç¦®ç‰©åç¨±:</label>
            <input type="text" id="giftName" placeholder="ä¾‹å¦‚: ä¸€æŸç«ç‘°èŠ±" maxlength="50">

            <label for="giftDescription">ç¦®ç‰©æè¿°:</label>
            <textarea id="giftDescription" placeholder="ä¾‹å¦‚: å¸Œæœ›é€™æŸèŠ±èƒ½å¸¶çµ¦ä½ å¿«æ¨‚..." rows="3" maxlength="200"></textarea>

            <label for="giftValue">ç¦®ç‰©åƒ¹å€¼ (å…ƒ):</label>
            <input type="number" id="giftValue" placeholder="ä¾‹å¦‚: 99" min="0" step="0.01">
        </div>
        <div class="function-modal-footer">
            <button onclick="closeFunctionModal('giftModal')" class="function-btn-cancel">å–æ¶ˆ</button>
            <button onclick="confirmGift()" class="function-btn-confirm">é€å‡ºç¦®ç‰©</button>
        </div>
    </div>
</div>

<div id="deleteConfirmModal" class="delete-confirm-modal hidden">
    <div class="delete-confirm-content">
        <div class="delete-confirm-title">åˆ é™¤èŠå¤©å®¤</div>
        <div class="delete-confirm-message">
            ç¡®å®šè¦åˆ é™¤èŠå¤©å®¤<br>
            ã€Œ<span id="deleteConfirmChatName" class="delete-confirm-chat-name"></span>ã€å—ï¼Ÿ
            <br><br>
            <small style="color: #999;">åˆ é™¤åæ— æ³•æ¢å¤ï¼Œä½†å¯ä»¥é‡æ–°åˆ›å»º</small>
        </div>
        <div class="delete-confirm-buttons">
            <button class="delete-confirm-btn function-btn-cancel" onclick="cancelDeleteChat()">å–æ¶ˆ</button>
            <button class="delete-confirm-btn function-btn-confirm" onclick="confirmDeleteChat()">åˆ é™¤</button>
        </div>
    </div>
</div>

<!-- å¯æ‹–åŠ¨çš„æµ®åŠ¨å¿«æ·æŒ‰é’® -->
<div id="floatingAssistant" class="floating-assistant">
    <div class="floating-button" id="floatingButton">
        <span class="floating-icon">â­</span>
    </div>
</div>

<!-- å¿«æ·æŒ‡ä»¤æ¨¡æ€çª—å£ -->
<div id="quickActionsModal" class="quick-actions-modal hidden">
    <div class="quick-actions-content">
        <div class="quick-actions-header">
            <h3>å¿«æ·æŒ‡ä»¤</h3>
            <span class="close-button" onclick="closeQuickActions()">&times;</span>
        </div>
        <div class="quick-actions-body">
            <!-- AIå¯åŠ¨æŒ‰é’® -->
            <div class="quick-action-section">
                <h4>AIåŠ©æ‰‹</h4>
                <button class="quick-action-btn ai-btn" onclick="triggerAI()">
                    ğŸ¤– å¯åŠ¨AI
                </button>
                <button class="quick-action-btn story-btn" onclick="triggerStoryDevelopment()">
                    ğŸ“– æ²¿ç”ŸåŠ‡æƒ…
                </button>
            </div>

            <!-- æ•…äº‹æ¬„ä½ -->
            <div class="quick-action-section" id="storySection">
                <div style="display: flex; align-items: center; justify-content: space-between; margin-top: 18px;">
                    <h4 style="margin: 0;">æ•…äº‹æ¬„ä½</h4>
                    <button id="addStoryBtn" class="quick-action-btn add-story-btn" style="padding: 4px 12px; font-size: 18px; background: #eee; color: #666; border-radius: 8px; margin-left: 10px;" onclick="openAddStoryModal()">ï¼‹</button>
                </div>
                <div id="storyList" style="margin-top: 10px;"></div>
            </div>
        </div>
    </div>
</div>

<!-- === æ–°å¢æ•…äº‹ Modal === -->
<div id="addStoryModal" class="hidden" style="position:fixed;top:0;left:0;width:100vw;height:100vh;background:#0005;z-index:9999;display:flex;align-items:center;justify-content:center;">
  <div style="background:#fff;padding:24px 28px 18px 28px;border-radius:12px;min-width:320px;box-shadow:0 2px 12px #0002;">
    <div style="font-size:17px;font-weight:bold;margin-bottom:12px;">æ–°å¢æ•…äº‹</div>
    <div style="margin-bottom:14px;">
      <label>å…§å®¹ï¼š</label><br>
      <textarea id="storyContentInput" rows="4" style="width:100%;padding:5px 8px;margin-top:2px;"></textarea>
    </div>
    <div style="text-align:right;">
      <button onclick="closeAddStoryModal()" class="function-btn-cancel" style="margin-right:10px;">å–æ¶ˆ</button>
      <button onclick="addStoryToList()" class="function-btn-confirm">ç¢ºå®š</button>
    </div>
  </div>
</div>

<!-- åŠ‡æƒ…é˜…è¯»çª—å£ -->
<div id="storyModal" class="story-modal hidden">
    <div class="story-modal-content">
        <div class="story-modal-header">
            <h3 id="storyTitle">åŠ‡æƒ…å†…å®¹</h3>
            <span class="story-modal-close" onclick="closeStoryModal()">&times;</span>
        </div>
        <div class="story-modal-body">
            <div class="story-content-area">
                <div id="storyContent" class="story-text">
                    åŠ‡æƒ…å†…å®¹å°†åœ¨è¿™é‡Œæ˜¾ç¤º...
                </div>
            </div>
        </div>
        <div class="story-modal-footer">
            <button id="storyPrevBtn" class="story-nav-btn" onclick="storyPrevPage()">
                <span>â—€</span>
                <span>ä¸Šä¸€é¡µ</span>
            </button>
            <div id="storyPageInfo" class="story-page-info">1 / 1</div>
            <button id="storyNextBtn" class="story-nav-btn" onclick="storyNextPage()">
                <span>ä¸‹ä¸€é¡µ</span>
                <span>â–¶</span>
            </button>
        </div>
    </div>
</div>

<!-- å¿«æ·æŒ‡ä»¤é¢æ¿å€åŸŸ ... -->
<div id="quickActionsPanel" class="hidden">
  <!-- å…¶ä»–å€å¡Š ... -->

  <!-- === æ•…äº‹æ¬„ä½å€å¡Š === -->
  <div id="storyListSection" style="margin:18px 0 0 0;padding:12px 10px 10px 10px;background:#f8f8fc;border-radius:10px;box-shadow:0 1px 4px #0001;">
    <div style="display:flex;align-items:center;justify-content:space-between;">
      <span style="font-weight:bold;font-size:15px;">æ•…äº‹æ¬„ä½</span>
      <button onclick="openAddStoryModal()" style="background:#fff;border:1px solid #bbb;border-radius:6px;padding:2px 12px;font-size:15px;cursor:pointer;">ï¼‹</button>
    </div>
    <div id="storyList" style="margin-top:10px;"></div>
  </div>
</div>

<script src="chat-config.js"></script>
<script src="chat-core.js"></script>
<script src="chat-ui.js"></script>
<script src="chat-features.js"></script>
    <script src="transfer-timer.js"></script>
    <script src="chat-messages.js"></script>
    <script src="chat-edit-mode.js"></script>
<script src="chat_user_features.js"></script>
<script src="floating-assistant.js"></script>
<script src="theme-settings.js"></script>
</body>
</html>